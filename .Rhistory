"Japan|Edo|Sushi|Kampachi|Iketeru|Menya|Nobu|Omakase|TOKYO|Tokyo|Tonkatsu|Udon|Soba|Ichibanya|Maruhi|Omulab|Zipangu|Miyabi|Izakaya Hanazen|hokkaido|Senya|IPPUDO|Umai-Ya|Ichiban|Yakiniku|Nihon|Lucky Tora|Hokkaido|Mo-Mo Paradise|Sushi|sushi|Uokatsu|Ramen|Tempura|Izakaya|Tokyo|Kyoto|Oishii|Gyoza|Ichiban|Tonkotsu|Tonkatsu|Sakura|Yakitori|Kyush|Teppanyaki|Taka|Kikubari|Ichiyutei|Enju|Okonomi|Toridoki|Syokudo|Tsukiji|Yuzu|Madam Salma|Fu-Rin"
) ~ "Japanese",
# Why not merge all Korean BBQ into grill?
str_detect(
restaurant,
"Filipino|Bali|Vietnam|GOODDAM|Korea|Sao Nam|Naughty Nuri's|KyoChon|Viet|Dakgalbi|Sopoong|Kung Jung|Saigon|Sae Ma Eul|KoRyo-Won|Koryowon|Persia|Astana|Buns & Noodles|Kyochon|Topokki"
) ~ "Other Asian",
# Do not str_detect(.x, "bar")
str_detect(restaurant, "Whisky|Lounge|Bar|Decanter|Knowhere Bangsar|The Locker & Loft|Tom, Dick & Harry's|WET|The Enclave|Out of Africa|Opium|THIRTY8|Healy Mac's|TEMPTationS|Loco bar|La Bodega|Vertigo|The Social|No Black Tie|The BAR|O'Galito|Table 23|D Legends bar|Bobo KL|Rock Bottom|twenty-one kitchen+bar|Bentley's Pub|Vinh City Entertainment|twenty-one|Malones|White Horse Tavern|Supperclub KL|Backyard|The Ceylon bar|W1 Dining & Cocktails|Splash|Drop Exchange|Boardwalk|Deep Blue|The Sticky Wicket|OneSixFive|The Attic|Concubine KL|The Green Man|THE BAR|Marini’s on 57|Rooftop 25"
) ~ "Bar",
str_detect(restaurant, "Cafe|Grind|Café|Tujo|cafe|Alexis|The Loaf|Yellow Brick Road|Huckleberry|TWG|Newens Tea House|Miss Ellie Tea House|Frisky Goat|Urbean|Ra-Ft|Backofen|STG Bukit Ceylon|VCR|Rise & Shine by Tapestry|Kafe|Kaffe|Kopi|Latte|Kopitiam"
) ~ "Cafe",
str_detect(
restaurant,
"Kerala|India|Lanka|Malabar|Curry|Raju|Bhavan|Thosai|Tandoor|Bombay|Gem Restaurant|Nasi Kandar|NADODI|Qureshi|RSMY|Sangeetha|Nirwana|Asian Rice Pot|Masala|Annalakshmi|Aliyaa|MTR|Devi's Corner|WTF - What Tasty Food|Nadodi|Delhi Royale|FLOUR|Bakti Woodlands|Vishal Food|Banana Leaf|Hyderabad|sarvana bhavan|Spice Garden|Roti|TasteBud|Chapati|Pakistani|Jai Hind|BananaBro|Naan|SK Corner|Sri Paandi|Majapahit|Nan |GinRikSha|Briyani|Biryani|Maju Palace|Seetharam|Havelly|Punjab|Goa By Sapna Anand|Swaadisht|Mamak|Sri|Chapathi|Moghul|Rani|Aryan|Yarl|Sagar|ABC Foods Corner|Sheesh Mahal|Mallikas"
) ~ "South Asian",
# Buffet list
restaurant %in% trip_buffet_list ~ "Buffet",
restaurant %in% google_buffet_list ~ "Buffet",
str_detect(restaurant, "Flock, W Kuala Lumpur|HYdeout By Grand Hyatt Kuala Lumpur|Curate"
) ~ "Buffet",
# List of fusion restaurants
restaurant %in% trip_fusion_list ~ "Fusion",
restaurant %in% google_fusion_list ~ "Fusion",
str_detect(restaurant, "Symphony by Chef Jo|Darren Chin|Dewakan|DC Restaurant|Sitka|Ginger Restaurant|Table & Apron|Foodsbury"
) ~ "Fusion",
# Unfortunate, there aren't enough Latino restaurants for their own category
str_detect(restaurant, "Latino|Mexican|Carretas|Mexico|Frontera|Mexicana|Cocina"
) ~ "Other",
str_detect(restaurant, "Oliver Gourmet|Seafood|Shell Out|BAIT|Fisherman|Fish & Co|Shucked|Delay No More Crab Restaurant|Ombak"
) ~ "Seafood",
str_detect(restaurant, "Vasco's|Latest Recipe|Lemon Garden|Prime|Gastro Sentral|Chinoz On The Park|Shook|Plane In The City|Contango|The Living Room|Curate At Four Seasons|Beta KL|CEDAR on 15|The Apartment|The Grand Getaway|Strato|Ril's|Chocha|Wizards at Tribeca|Nipah|Joloko|Leonardo's Dining Room & Wine Loft|Roofino Skydining|Troika|Dining In The Dark KL|PLOY|Atlas Gourmet Market|WIP|Nathalie Gourmet Studio|Altitude|The Canteen by Chef Adu|Latitude 03|The Orchid Conservatory|Graze Restaurant|Zende Restaurant|Crystal|Cielo KL|Cedar On 15"
) ~ "Other Upmarket",
# Just mopping up all the Dai Chow
# I feel this is going to create problems down the line
str_detect(restaurant, "Restoran"
) ~ "Chinese",
TRUE ~ "Other"
)) |>
mutate(rowid = row_number())
}
trip_kl_cuisine <- trip_reviews |>
filter(location %in% c("KL", "Petaling Jaya", "Shah Alam")) |>
reviews_cuisine_cleaning()
google_kl_cuisine <- google_reviews |>
filter(location %in% c("KL", "Petaling Jaya", "Shah Alam")) |>
reviews_cuisine_cleaning()
trip_kl_cuisine |> write_csv("./data/trip_kl_cuisine.csv")
google_kl_cuisine |> write_csv("./data/google_kl_cuisine.csv")
summary_stats <- rbind(
trip_kl_cuisine |>
mutate(count = 1) |>
group_by(restaurant) |>
mutate(reviews = sum(count)) |>
ungroup() |>
filter(reviews >= 20) |>
summarise(mean_rating = mean(rating),
median_rating = median(rating),
mode_rating = Mode(rating)) |>
mutate(source = "Trip Advisor"),
google_kl_cuisine |>
mutate(count = 1) |>
group_by(restaurant) |>
mutate(reviews = sum(count)) |>
ungroup() |>
filter(reviews >= 20) |>
summarise(mean_rating = mean(rating),
median_rating = median(rating),
mode_rating = Mode(rating)) |>
mutate(source = "Google")
)
google_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n()) |>
relocate(location, .after = reviews) |>
arrange(desc(mean_rating)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 140% ;",
"Google reviews: restaurants in the Klang Valley"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
datatable(filter = list(position = "top", clear = FALSE),
options = list(pageLength = 10, scrollX = TRUE
#                                  initComplete = htmlwidgets::JS(
# "function(settings, json) {",
# paste0("$(this.api().table().container()).css({'font-size': '", "8.5pt", "'});"),
# "}")),
),
caption = htmltools::tags$caption(style = 'caption-side: top;
text-align: center;
color:black; font-size:120% ;',
"2021 conflict actors")) %>%
formatRound(c("fatalities", "total_events", "battles", "violence_against_civilians", "explosions_remote_violence",
"protests", "strategic_developments"), digits = 0) %>%
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
google_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n()) |>
relocate(location, .after = reviews) |>
arrange(desc(mean_rating)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 120% ;",
"Google reviews: restaurants in the Klang Valley"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
google_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n()) |>
relocate(location, .after = reviews) |>
arrange(desc(mean_rating))
google_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n()) |>
relocate(location, .after = reviews) |>
arrange(desc(mean_rating)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 120% ;",
"Google reviews: restaurants in the Klang Valley"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
google_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n()) |>
relocate(location, .after = reviews) |>
rename(`mean rating` = mean_rating,
`median rating` = median_rating) |>
arrange(desc(mean_rating)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 120% ;",
"Google reviews: restaurants in the Klang Valley"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
google_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n(), .groups = "drop") |>
relocate(location, .after = reviews) |>
rename(`mean rating` = mean_rating,
`median rating` = median_rating) |>
arrange(desc(mean_rating)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 120% ;",
"Google reviews: restaurants in the Klang Valley"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
google_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n(), .groups = "drop") |>
relocate(location, .after = reviews)
google_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n(), .groups = "drop") |>
relocate(location, .after = reviews) |>
rename(`mean rating` = mean_rating,
`median rating` = median_rating) |>
arrange(desc(`mean rating`)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 120% ;",
"Google reviews: restaurants in the Klang Valley"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
trip_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n(), .groups = "drop") |>
relocate(location, .after = reviews) |>
rename(`mean rating` = mean_rating,
`median rating` = median_rating) |>
arrange(desc(`mean rating`))
trip_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n(), .groups = "drop") |>
relocate(location, .after = reviews) |>
rename(`mean rating` = mean_rating,
`median rating` = median_rating) |>
arrange(desc(`mean rating`)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 120% ;",
"Trip Advisor reviews: restaurants in the Klang Valley"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
trip_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n(), .groups = "drop") |>
filter(reviews >= 20) |>
relocate(location, .after = reviews) |>
rename(`mean rating` = mean_rating,
`median rating` = median_rating) |>
arrange(desc(`mean rating`)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 120% ;",
"Trip Advisor reviews: restaurants in the Klang Valley"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
trip_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n(), .groups = "drop") |>
filter(reviews >= 20) |>
relocate(location, .after = reviews) |>
rename(`mean rating` = mean_rating,
`median rating` = median_rating) |>
arrange(desc(`mean rating`)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 110% ;",
"Trip Advisor: restaurants in the Klang Valley with more than 20 reviews"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
google_kl_cuisine |>
select(restaurant, cuisine, rating, location) |>
group_by(restaurant, cuisine, location) |>
summarise(mean_rating = round(mean(rating), 2),
median_rating = median(rating),
reviews = n(), .groups = "drop") |>
filter(reviews >= 20) |>
relocate(location, .after = reviews) |>
rename(`mean rating` = mean_rating,
`median rating` = median_rating) |>
arrange(desc(`mean rating`)) |>
datatable(filter = list(position = "top", clear = "FALSE"),
options = list(pageLength = 10, scrollX = TRUE),
caption = htmltools::tags$caption(
style =
"caption-side: top;
text-align: center;
color: black;
font-size: 120% ;",
"Google: restaurants in the Klang Valley with more than 20 reviews"
)) |>
formatStyle(0, target = "row", lineHeight = "85%", fontSize = "80%")
combined_google_trip |>
group_by(restaurant, source) |>
summarise(rating = mean(rating),
.groups = "drop") |>
pivot_wider(names_from = source,
values_from = rating) |>
left_join(
combined_google_trip |>
count(restaurant,
name = "count"),
by = "restaurant"
) |>
left_join(
combined_google_trip |>
distinct(restaurant, cuisine),
by = "restaurant"
) |>
filter(!is.na(Google) & !is.na(TripAdvisor)) |>
ggplot(aes(x = Google, y = TripAdvisor)) +
geom_smooth(alpha = .1, size = 0, span = .5,
method = "lm") +
stat_smooth(geom = "line", alpha = .1, size =.5, span = .5,
method = "lm") +
geom_point(aes(colour = cuisine,
size = count)) +
scale_colour_viridis_d(option = "turbo") +
ggrepel::geom_text_repel(aes(label = restaurant),
size = 1.2) +
labs(title = "Comparison between Google and TripAdvisor restaurant ratings",
subtitle = "Size indicates number of reviews",
y = "Trip Advisor mean rating",
x = "Google mean rating",
colour = "Cuisine",
size = "Review count") +
# guides(colour = guide_legend(override.aes = list(size = .7))) +
theme(legend.title = element_text(size = 6),
legend.text = element_text(size = 6),
legend.key.size = unit(0.3, "lines"))
restaurant_fuzzy_match <- stringdist_join(
trip_reviews |>
filter(location %in% c("KL", "Petaling Jaya", "Shah Alam")) |>
distinct(restaurant) |>
mutate(restaurant_match = str_remove_all(restaurant, "Restaurant|Cuisine|restaurant|Restoran|Curry House|Japanese"),
restaurant_match = trimws(restaurant_match)) |>
select(restaurant_trip = restaurant,
restaurant_match),
google_kl_cuisine |> filter(location %in% c("KL", "Petaling Jaya", "Shah Alam")) |>
distinct(restaurant)|>
mutate(restaurant_match = str_remove_all(restaurant, "Restaurant|Cuisine|restaurant|Restoran|Curry House|Japanese"),
restaurant_match = trimws(restaurant_match)) |>
select(restaurant_google = restaurant,
restaurant_match),
by = "restaurant_match",
ignore_case = TRUE,
method = "jw",
max_dist = 99,
distance_col = "dist"
) |>
group_by(restaurant_match.x) |>
slice_min(order_by = dist, n = 1) |>
arrange((dist)) |>
select(match_x = restaurant_match.x,
match_y = restaurant_match.y,
dist,
restaurant_google,
restaurant_trip) |>
ungroup()
both_google_and_trip <- restaurant_fuzzy_match |>
filter(match_x != "Teh Laris Cafe" | match_y != "Thosai Cafe") |>
filter(match_x != "The Ming Room" | match_y != "The Living Room") |>
filter(match_x != "Cilantro & Wine Bar" | match_y != "ZENZERO & Wine Bar") |>
filter(match_x != "Kedai Kopi Pak Ngah" | match_y != "Kedai Kopi Lai Foong") |>
filter(match_x != "Shanghai" | match_y != "Old Shanghai") |>
filter(match_x != "Ah Ni Bak Kut Teh" | match_y != "Ah Sang Bak Kut Teh") |>
filter(match_x != "Pin Wei Seafood" | match_y != "Hoi Peng Seafood") |>
filter(match_x != "Cafe Cafe" | match_y != "Cafe ETC") |>
filter(match_x != "Tao Chinese" | match_y != "Ee Chinese") |>
filter(match_x != "Seoul Garden" | match_y != "Lemon Garden") |>
filter(match_x != "De.Wan" | match_y != "Dewakan") |>
filter(dist <= 0.16666667)
combined_google_trip <- trip_kl_cuisine |>
filter(restaurant %in% both_google_and_trip$restaurant_trip) |>
select(cuisine, location, restaurant, rating, review) |>
mutate(source = "TripAdvisor") |>
rbind(
google_kl_cuisine |>
filter(restaurant %in% both_google_and_trip$restaurant_google) |>
select(cuisine, location, restaurant, rating, review) |>
mutate(source = "Google")
) |>
mutate(row_id = row_number()) |>
left_join(
both_google_and_trip |>
distinct(restaurant_google, restaurant_trip) |>
rename(restaurant = restaurant_trip),
by = c("restaurant")
) |>
left_join(
both_google_and_trip |>
distinct(restaurant_google, restaurant_trip) |>
rename(restaurant = restaurant_google),
by = c("restaurant")
) |>
mutate(restaurant_new = ifelse(!is.na(restaurant_google),
restaurant_google,
restaurant)) |>
group_by(row_id, location, cuisine, restaurant = restaurant_new, review, source) |>
summarise(rating = mean(rating),
.groups = "drop") |>
mutate(restaurant = trimws(restaurant))
combined_google_trip |>
group_by(restaurant, source) |>
summarise(rating = mean(rating),
.groups = "drop") |>
pivot_wider(names_from = source,
values_from = rating) |>
left_join(
combined_google_trip |>
count(restaurant,
name = "count"),
by = "restaurant"
) |>
left_join(
combined_google_trip |>
distinct(restaurant, cuisine),
by = "restaurant"
) |>
filter(!is.na(Google) & !is.na(TripAdvisor)) |>
ggplot(aes(x = Google, y = TripAdvisor)) +
geom_smooth(alpha = .1, size = 0, span = .5,
method = "lm") +
stat_smooth(geom = "line", alpha = .1, size =.5, span = .5,
method = "lm") +
geom_point(aes(colour = cuisine,
size = count)) +
scale_colour_viridis_d(option = "turbo") +
ggrepel::geom_text_repel(aes(label = restaurant),
size = 1.2) +
labs(title = "Comparison between Google and TripAdvisor restaurant ratings",
subtitle = "Size indicates number of reviews",
y = "Trip Advisor mean rating",
x = "Google mean rating",
colour = "Cuisine",
size = "Review count") +
# guides(colour = guide_legend(override.aes = list(size = .7))) +
theme(legend.title = element_text(size = 6),
legend.text = element_text(size = 6),
legend.key.size = unit(0.3, "lines"))
ggsave("./plots/restaurant_comparison_trip_google.png", height = 9, width = 11, units = "in")
combined_google_trip |>
mutate(new_rating = ifelse(rating %in% c(5), 1, 0)) |>
group_by(restaurant, source) |>
summarise(new_rating = mean(new_rating),
.groups = "drop") |>
pivot_wider(names_from = "source",
values_from = new_rating) |>
left_join(
combined_google_trip |>
count(restaurant,
name = "count"),
by = "restaurant"
) |>
left_join(
combined_google_trip |>
distinct(restaurant, cuisine),
by = "restaurant"
) |>
filter(!is.na(Google) & !is.na(TripAdvisor)) |>
ggplot(aes(x = Google, y = TripAdvisor)) +
geom_smooth(alpha = .1, size = 0, span = .5) +
stat_smooth(geom = "line", alpha = .1, size =.5, span = .5) +
geom_point(aes(colour = cuisine,
size = count)) +
scale_colour_viridis_d(option = "turbo") +
ggrepel::geom_text_repel(aes(label = restaurant),
size = 1.2) +
scale_x_continuous(labels = percent, breaks = c(0, 0.2, 0.3, 0.4, 0.5,
0.6, 0.7, 0.8, 0.9, 1),
limits = c(0.2, .87)) +
scale_y_continuous(labels = percent, breaks = c(0, 0.2, 0.3, 0.4, 0.5,
0.6, 0.7, 0.8, 0.9, 1),
limits = c(0.2, .94)) +
scale_size_continuous(breaks = c(100, 500, 1000, 2000)) +
labs(title = "Comparison between Google and TripAdvisor using percentage of 5-star reviews",
subtitle = "Size indicates number of reviews.",
y = "% of 5-star ratings, Trip Advisor",
x = "% of 5-star ratings, Google",
caption = "Sources: Google; TripAdvisor; Ng Choon Khon.",
colour = "Cuisine",
size = "Review count") +
# guides(colour = guide_legend(override.aes = list(size = .7))) +
theme(legend.title = element_text(size = 6),
legend.text = element_text(size = 6),
legend.key.size = unit(0.3, "lines"))
ggsave("./plots/restaurant_comparison_new_ratings2.png", height = 9, width = 11, units = "in")
