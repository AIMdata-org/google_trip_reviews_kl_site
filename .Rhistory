mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
# Because they stayed long enough for dessert?
"ice cream",
"indian food",
"chinese restaurant",
"roast pork",
"salted egg",
"dim sum",
"nasi lemak",
"fried chicken",
"fried rice",
"japanese food",
"thai food",
"chicken rice",
"italian restaurant",
"western food",
"nasi kandar",
"char siew"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
axis.text.x = element_text(size = 5)) +
labs(title = "Common foods by topic, Google reviews in the Klang Valley",
y = "")
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
# Because they stayed long enough for dessert?
"ice cream",
"indian food",
"chinese restaurant",
"roast pork",
"salted egg",
"dim sum",
"nasi lemak",
"fried chicken",
"fried rice",
"japanese food",
"thai food",
"chicken rice",
"italian restaurant",
"western food",
"nasi kandar",
"char siew"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#780000",
"2. Recommended" = "#669bbc")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
axis.text.x = element_text(size = 5)) +
labs(title = "Common foods by topic, Google reviews in the Klang Valley",
y = "")
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
# Because they stayed long enough for dessert?
"ice cream",
"indian food",
"chinese restaurant",
"roast pork",
"salted egg",
"dim sum",
"nasi lemak",
"fried chicken",
"fried rice",
"japanese food",
"thai food",
"chicken rice",
"italian restaurant",
"western food",
"nasi kandar",
"char siew"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#c1121f",
"2. Recommended" = "#a2d2ff")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
axis.text.x = element_text(size = 5)) +
labs(title = "Common foods by topic, Google reviews in the Klang Valley",
y = "")
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
# Because they stayed long enough for dessert?
"ice cream",
"indian food",
"chinese restaurant",
"roast pork",
"salted egg",
"dim sum",
"nasi lemak",
"fried chicken",
"fried rice",
"japanese food",
"thai food",
"chicken rice",
"italian restaurant",
"western food",
"nasi kandar",
"char siew"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#e63946",
"2. Recommended" = "#2a9d8f")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
axis.text.x = element_text(size = 5)) +
labs(title = "Common foods by topic, Google reviews in the Klang Valley",
y = "")
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
# Because they stayed long enough for dessert?
"ice cream",
"indian food",
"chinese restaurant",
"roast pork",
"salted egg",
"dim sum",
"nasi lemak",
"fried chicken",
"fried rice",
"japanese food",
"thai food",
"chicken rice",
"italian restaurant",
"western food",
"nasi kandar",
"char siew"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#f28482",
"2. Recommended" = "#2a9d8f")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
axis.text.x = element_text(size = 5)) +
labs(title = "Common foods by topic, Google reviews in the Klang Valley",
y = "")
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
# Because they stayed long enough for dessert?
"ice cream",
"indian food",
"chinese restaurant",
"roast pork",
"salted egg",
"dim sum",
"nasi lemak",
"fried chicken",
"fried rice",
"japanese food",
"thai food",
"chicken rice",
"italian restaurant",
"western food",
"nasi kandar",
"char siew"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#f28482",
"2. Recommended" = "#52b69a")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
axis.text.x = element_text(size = 5)) +
labs(title = "Common foods by topic, Google reviews in the Klang Valley",
y = "")
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
# Because they stayed long enough for dessert?
"ice cream",
"indian food",
"chinese restaurant",
"roast pork",
"salted egg",
"dim sum",
"nasi lemak",
"fried chicken",
"fried rice",
"japanese food",
"thai food",
"chicken rice",
"italian restaurant",
"western food",
"nasi kandar",
"char siew"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#e26d5c",
"2. Recommended" = "#52b69a")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
axis.text.x = element_text(size = 5)) +
labs(title = "Common foods by topic, Google reviews in the Klang Valley",
y = "")
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
# Because they stayed long enough for dessert?
"ice cream",
"indian food",
"chinese restaurant",
"roast pork",
"salted egg",
"dim sum",
"nasi lemak",
"fried chicken",
"fried rice",
"japanese food",
"thai food",
"chicken rice",
"italian restaurant",
"western food",
"nasi kandar",
"char siew"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#ff595e",
"2. Recommended" = "#8ac926")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
axis.text.x = element_text(size = 5)) +
labs(title = "Common foods by topic, Google reviews in the Klang Valley",
y = "")
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
"reasonable price",
"highly recommend",
"highly recommended",
"amazing food",
"nice environment",
"food quality",
"nice food",
"bit pricey",
"excellent service",
"decent food",
"friendly staff",
"excellent food"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#ff595e",
"2. Recommended" = "#8ac926")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"))
google_bigrams_topics |>
group_by(topic) |>
slice_max(beta, n = 20) |>
ungroup() |>
arrange(topic, -beta) |>
ggplot(aes(x = beta, y = reorder_within(term, beta, topic), fill = topic)) +
geom_col() +
facet_wrap(~ topic, scales = "free") +
scale_y_reordered()
knitr::opts_chunk$set(echo = FALSE,
warning = FALSE,
message = FALSE,
fig.width = 9)
library(tidyverse)
library(here)
library(janitor)
library(scales)
library(tidytext)
library(widyr)
library(ggraph)
library(patchwork)
library(kableExtra)
library(fuzzyjoin)
library(viridis)
library(textdata)
library(stringr)
library(topicmodels)
`%out%` <- Negate(`%in%`)
options(scipen = 100)
theme_set(theme_light())
range_wna <- function(x){(x-min(x, na.rm = TRUE))/(max(x, na.rm = TRUE)-min(x, na.rm = TRUE))}
Mode <- function(x) {
ux <- unique(x)
ux[which.max(tabulate(match(x, ux)))]
}
trip_kl_cuisine <- read_csv("./data/trip_kl_cuisine.csv")
google_kl_cuisine <- read_csv("./data/google_kl_cuisine.csv")
google_rating_words <- google_kl_cuisine |>
select(rowid, rating, review) |>
unnest_tokens(word, review) |>
# mutate(word = SnowballC::wordStem(word, language = "porter")) |>
anti_join(stop_words, by = "word") |>
add_count(word, rating)
trip_rating_words <- trip_kl_cuisine |>
select(rowid, review, rating) |>
unnest_tokens(word, review) |>
# mutate(word = SnowballC::wordStem(word, language = "porter")) |>
anti_join(stop_words, by = "word") |>
add_count(word, rating)
google_rating_bigrams <- google_kl_cuisine |>
select(rowid, rating, review, cuisine) |>
unnest_tokens(bigram, review, token = "ngrams", n = 2) |>
filter(!is.na(bigram)) |>
add_count(bigram) |>
separate(bigram, c("word1", "word2"), sep = " ") |>
filter(!word1 %in% stop_words$word) |>
filter(!word2 %in% stop_words$word) |>
count(word1, word2, rating, sort = TRUE) |>
unite(bigram, word1, word2, sep = " ") |>
bind_tf_idf(bigram, rating, n)
trip_rating_bigrams <- trip_kl_cuisine |>
select(rowid, rating, review, cuisine) |>
unnest_tokens(bigram, review, token = "ngrams", n = 2) |>
filter(!is.na(bigram)) |>
add_count(bigram) |>
separate(bigram, c("word1", "word2"), sep = " ") |>
filter(!word1 %in% stop_words$word) |>
filter(!word2 %in% stop_words$word) |>
count(word1, word2, rating, sort = TRUE) |>
unite(bigram, word1, word2, sep = " ") |>
bind_tf_idf(bigram, rating, n)
google_bigrams_dtm <- google_rating_bigrams |>
cast_dtm(rating, bigram, n)
google_bigrams_lda <-
LDA(google_bigrams_dtm, k = 2, control = list(seed = 133))
google_bigrams_topics <- tidy(google_bigrams_lda, matrix = "beta")
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
group_by(topic) |>
slice_max(beta, n = 20) |>
ungroup() |>
arrange(topic, -beta) |>
ggplot(aes(x = beta, y = reorder_within(term, beta, topic), fill = topic)) +
geom_col() +
facet_wrap(~ topic, scales = "free") +
scale_y_reordered() +
labs(title = "Bigram probabilities per topic",
subtitle = "From Google reviews of restaurants in the Klang Valley.\nOnly shows bigrams that occur more than 20 times in the dataset.",
y = "",
x = "Per-topic probability (beta)") +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
strip.text = element_text(size = 10, face = "bold"))
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
group_by(topic) |>
slice_max(beta, n = 20) |>
ungroup() |>
arrange(topic, -beta) |>
ggplot(aes(x = beta, y = reorder_within(term, beta, topic), fill = topic)) +
geom_col() +
scale_fill_manual(
values = c("1. Everything else" = "#ff595e",
"2. Recommended" = "#8ac926")
) +
facet_wrap(~ topic, scales = "free") +
scale_y_reordered() +
labs(title = "Bigram probabilities per topic",
subtitle = "From Google reviews of restaurants in the Klang Valley.\nOnly shows bigrams that occur more than 20 times in the dataset.",
y = "",
x = "Per-topic probability (beta)") +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
strip.text = element_text(size = 10, face = "bold"))
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
group_by(topic) |>
slice_max(beta, n = 20) |>
ungroup() |>
arrange(topic, -beta) |>
ggplot(aes(x = beta, y = reorder_within(term, beta, topic), fill = topic)) +
geom_col() +
scale_fill_manual(
values = c("1. Everything else" = "#ff595e",
"2. Recommended" = "#8ac926")
) +
facet_wrap(~ topic, scales = "free_y") +
scale_y_reordered() +
labs(title = "Bigram probabilities per topic",
subtitle = "From Google reviews of restaurants in the Klang Valley.\nOnly shows bigrams that occur more than 20 times in the dataset.",
y = "",
x = "Per-topic probability (beta)") +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"),
strip.text = element_text(size = 10, face = "bold"))
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
"reasonable price",
"highly recommend",
"highly recommended",
"amazing food",
"nice environment",
"food quality",
"nice food",
"bit pricey",
"excellent service",
"decent food",
"friendly staff",
"excellent food"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#ff595e",
"2. Recommended" = "#8ac926")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black"))
google_bigrams_topics |>
mutate(topic = ifelse(
topic == 1, "1. Everything else", "2. Recommended"
)) |>
filter(term %in% c(
"reasonable price",
"highly recommend",
"highly recommended",
"amazing food",
"nice environment",
"food quality",
"nice food",
"bit pricey",
"excellent service",
"decent food",
"friendly staff",
"excellent food"
)) |>
ggplot(aes(x = beta,
y = fct_rev(topic))) +
geom_col(aes(fill = topic)) +
scale_fill_manual(
values = c("1. Everything else" = "#ff595e",
"2. Recommended" = "#8ac926")
) +
facet_wrap(~ term) +
guides(fill = "none") +
theme(strip.background = element_rect(fill = "black")) +
labs(y = "",
title = "Per-topic probabilities of general restaurant descriptors")
google_bigrams_topics |>
filter(term == "nice environment")
